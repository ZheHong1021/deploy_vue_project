"use strict";(self["webpackChunkdeploy_vue_project"]=self["webpackChunkdeploy_vue_project"]||[]).push([[575],{575:function(t,e,a){a.r(e),a.d(e,{default:function(){return J}});var s=a(4414),i=a(3449),l=a(2756),r=function(){var t=this,e=t._self._c;return e(i.A,{attrs:{fluid:""}},[e(l.A,[e(s.A,{attrs:{cols:"12"}},[e("CustomDataTable",{attrs:{items:t.items,itemsLength:t.itemsLength,options:t.options,headers:t.headers,height:"100%",loading:t.loading,disabled_select:t.disabled_select,"fixed-header":!1,"show-expand":""},on:{emitUpdateOptions:t.emitUpdateOptions,create:t.emitCreate,read:t.emitRead,update:t.emitUpdate,delete:t.emitDelete}})],1)],1),e("CustomDialog",{attrs:{title:"新增角色",color:"pink darken-2"},scopedSlots:t._u([{key:"body",fn:function(){return[t.create_dialog?e("CreateGroupForm",{on:{refresh:t.refreshData}}):t._e()]},proxy:!0}]),model:{value:t.create_dialog,callback:function(e){t.create_dialog=e},expression:"create_dialog"}}),e("CustomDialog",{attrs:{title:"瀏覽角色",color:"grey darken-2"},scopedSlots:t._u([{key:"body",fn:function(){return[t.read_dialog?e("ReadGroupForm",{attrs:{id:t.read_id}}):t._e()]},proxy:!0}]),model:{value:t.read_dialog,callback:function(e){t.read_dialog=e},expression:"read_dialog"}}),e("CustomDialog",{attrs:{title:"修改角色",color:"primary darken-2"},scopedSlots:t._u([{key:"body",fn:function(){return[t.update_dialog?e("UpdateGroupForm",{attrs:{id:t.update_id},on:{refresh:t.refreshData}}):t._e()]},proxy:!0}]),model:{value:t.update_dialog,callback:function(e){t.update_dialog=e},expression:"update_dialog"}})],1)},o=[],n=a(7473),d=a(6989),c=a(4846),u=a(4460),m=a(3740),h=a(174),p=a(7112),_=function(){var t=this,e=t._self._c;return e(h.A,{ref:"form",on:{submit:function(e){return e.preventDefault(),t.create.apply(null,arguments)}},model:{value:t.createFormValid,callback:function(e){t.createFormValid=e},expression:"createFormValid"}},[e(l.A,{staticClass:"justify-start"},[e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12",md:"6"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 角色代號: "),e("strong",{staticClass:"red--text font-weight-bold text-caption text-left text-sm-right"},[t._v(" (*必填) ")])]),e(p.A,{attrs:{"background-color":"white",outlined:"",label:"請填寫角色代號",rules:[t.rules["requiredRules"]],placeholder:"填寫範例: role"},model:{value:t.create_data["name"],callback:function(e){t.$set(t.create_data,"name",e)},expression:"create_data['name']"}})],1),e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12",md:"6"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 角色名稱: "),e("strong",{staticClass:"red--text font-weight-bold text-caption text-left text-sm-right"},[t._v(" (*必填) ")])]),e(p.A,{attrs:{"background-color":"white",outlined:"",label:"請填寫角色名稱",rules:[t.rules["requiredRules"]],placeholder:"填寫範例: 角色"},model:{value:t.create_data["name_zh"],callback:function(e){t.$set(t.create_data,"name_zh",e)},expression:"create_data['name_zh']"}})],1),e(s.A,{staticClass:"d-flex align-center justify-center gap-4",attrs:{cols:"12"}},[e(m.A,{staticClass:"font-weight-bold white--text",attrs:{color:"pink darken-2",type:"submit",width:"150",height:"50"}},[t._v(" 創建 ")])],1)],1)],1)},f=[],g={name:"CreateGroupForm",components:{},data(){return{create_data:{name:null,name_zh:null},createFormValid:!1,rules:d.aO}},computed:{},async mounted(){},methods:{async create(){if(this.$refs.form.validate(),this.createFormValid)try{const t=new FormData;for(const[a,s]of Object.entries(this.create_data))null!==s&&void 0!==s&&t.append(a,s);const e=await n.GS.create(t);201===e.status?(this.$swal.fire("創建成功","","success"),this.$emit("refresh")):this.$swal.fire("創建失敗","","error")}catch(t){console.error(t)}else this.$swal.fire("請確實填寫內容","","error")}}},b=g,x=a(1656),v=(0,x.A)(b,_,f,!1,null,"23dad47b",null),y=v.exports,w=function(){var t=this,e=t._self._c;return e(l.A,{staticClass:"justify-start"},[e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12",md:"6"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 角色代號: ")]),e(p.A,{attrs:{"background-color":"white",outlined:"",label:"請填寫代號",readonly:"",placeholder:"填寫範例: role"},model:{value:t.read_data["name"],callback:function(e){t.$set(t.read_data,"name",e)},expression:"read_data['name']"}})],1),e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12",md:"6"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 角色名稱: ")]),e(p.A,{attrs:{"background-color":"white",outlined:"",label:"請填寫名稱",readonly:"",placeholder:"填寫範例: 角色"},model:{value:t.read_data["name_zh"],callback:function(e){t.$set(t.read_data,"name_zh",e)},expression:"read_data['name_zh']"}})],1),e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 權限選擇: ")]),e("PermissionTreeList",{attrs:{readonly:""},model:{value:t.read_data["permissions"],callback:function(e){t.$set(t.read_data,"permissions",e)},expression:"read_data['permissions']"}})],1)],1)},k=[],C=a(6092),A=function(){var t=this,e=t._self._c;return e(l.A,[e(s.A,{attrs:{cols:"12"}},[e("div",{staticClass:"table-container mt-1"},[e("table",{staticClass:"black--text text-subtitle-2 text-md-subtitle-1",attrs:{id:"table",border:"1"}},[e("thead",{staticClass:"text-subtitle-2 text-md-subtitle-1"},t._l(t.headers,(function(a){return e("th",{key:a["value"]},[t._v(" "+t._s(a["text"])+" ")])})),0),e("tbody",{staticClass:"text-subtitle-2 text-md-subtitle-1",attrs:{align:"center"}},t._l(t.tree_permissions,(function(a,s){return e("tr",{key:s},t._l(t.headers,(function(i){return e("td",{key:i["value"],class:{is_checked:t.is_checked_column(a[i["value"]]?.id)}},["content_type_name"===i.value?[t._v(" "+t._s(s)+" ")]:[e("div",{staticClass:"d-flex flex-wrap justify-center align-center"},[e(C.A,{staticClass:"custom-checkbox",attrs:{value:a[i.value]["id"],label:a[i.value]["name"],readonly:t.readonly,disabled:t.readonly},on:{change:t.emitEvent},model:{value:t.permission_checked,callback:function(e){t.permission_checked=e},expression:"permission_checked"}})],1)]],2)})),0)})),0)])])])],1)},D=[],$=(a(4603),a(7566),a(8721),{name:"PermissionTreeList",props:{value:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1}},data(){return{loading:!0,permissions:[],tree_permissions:{},permission_checked:[],headers:[{text:"權限對象",value:"content_type_name"},{text:"查看",value:"查看"},{text:"新增",value:"新增"},{text:"修改",value:"修改"},{text:"刪除",value:"刪除"}]}},watch:{value:{immediate:!0,handler(t){this.permission_checked=this.value}}},async mounted(){await this.fetchPermission()},methods:{async fetchPermission(){try{const t=new URLSearchParams({page_size:-1}),e=await n.n1.get_all(t);if(200===e.status){const{data:t,count:a}=e.data;this.permissions=t,await this.getTreePermission()}}catch(t){console.log(t)}finally{this.loading=!1}},emitEvent(t){const{permission_checked:e}=this;e.includes(t)?this.$emit("input",e.filter((e=>e!==t))):t&&this.$emit("input",this.permission_checked)},getTreePermission(){const t={};for(const e of this.permissions){const{content_type_name:a,action:s}=e;t[a]||(t[a]={}),t[a][s]||(t[a][s]={}),t[a][s]=e}this.tree_permissions=t},is_checked_column(t){return this.value.includes(t)}}}),F=$,z=(0,x.A)(F,A,D,!1,null,"51880f69",null),G=z.exports,P={name:"ReadGroupForm",components:{PermissionTreeList:G},props:["id"],data(){return{loading:!0,read_data:{name:null,name_zh:null,permissions:[]}}},watch:{id:{immediate:!0,handler(t){t&&this.fetchData()}}},methods:{async fetchData(){try{const t=await n.GS.get_by_id(this.id);200===t.status&&(this.read_data={name:t.data.name,name_zh:t.data.name_zh,permissions:t.data.permissions.map((t=>t.id))})}catch(t){console.error(t)}finally{this.loading=!1}}}},V=P,j=(0,x.A)(V,w,k,!1,null,"e322287c",null),L=j.exports,R=function(){var t=this,e=t._self._c;return e(h.A,{ref:"form",on:{submit:function(e){return e.preventDefault(),t.update.apply(null,arguments)}},model:{value:t.updateFormValid,callback:function(e){t.updateFormValid=e},expression:"updateFormValid"}},[e(l.A,{staticClass:"justify-start"},[e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12",md:"6"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 角色代號: "),e("strong",{staticClass:"red--text font-weight-bold text-caption text-left text-sm-right"},[t._v(" (*必填) ")])]),e(p.A,{attrs:{"background-color":"white",outlined:"",label:"請填寫代號",rules:[t.rules["requiredRules"]],placeholder:"填寫範例: teacher"},model:{value:t.update_data["name"],callback:function(e){t.$set(t.update_data,"name",e)},expression:"update_data['name']"}})],1),e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12",md:"6"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 角色名稱: "),e("strong",{staticClass:"red--text font-weight-bold text-caption text-left text-sm-right"},[t._v(" (*必填) ")])]),e(p.A,{attrs:{"background-color":"white",outlined:"",label:"請填寫名稱",rules:[t.rules["requiredRules"]],placeholder:"填寫範例: 老師"},model:{value:t.update_data["name_zh"],callback:function(e){t.$set(t.update_data,"name_zh",e)},expression:"update_data['name_zh']"}})],1),e(s.A,{staticClass:"d-flex flex-column gap-2",attrs:{cols:"12"}},[e("div",{staticClass:"label-container font-weight-bold text-subtitle-1"},[t._v(" 權限選擇: ")]),e("PermissionTreeList",{model:{value:t.update_data["permissions"],callback:function(e){t.$set(t.update_data,"permissions",e)},expression:"update_data['permissions']"}})],1),e(s.A,{staticClass:"d-flex align-center justify-center gap-4",attrs:{cols:"12"}},[e(m.A,{staticClass:"font-weight-bold white--text",attrs:{color:"primary darken-2",type:"submit",width:"150",height:"50"}},[t._v(" 儲存 ")])],1)],1)],1)},U=[],S=(a(9874),{name:"UpdateGroupForm",components:{PermissionTreeList:G},props:["id"],data(){return{loading:!0,update_data:{},updateFormValid:!1,rules:d.aO}},watch:{id:{immediate:!0,handler(t){t&&this.fetchData()}}},methods:{async fetchData(){try{const t=await n.GS.get_by_id(this.id);if(200===t.status){const e=t.data;this.update_data={name:e["name"],name_zh:e["name_zh"],permissions:e["permissions"].map((t=>t["id"]))}}}catch(t){console.error(t)}finally{this.loading=!1}},async update(){if(this.$refs.form.validate(),this.updateFormValid)try{const t=new FormData;for(const[a,s]of Object.entries(this.update_data))null!==s&&void 0!==s&&t.append(a,s);const e=await n.GS.update(this.id,t);200===e.status?(this.$swal.fire("儲存成功","","success"),this.$emit("refresh")):this.$swal.fire("儲存失敗","","error")}catch(t){console.error(t)}else this.$swal.fire("請確實填寫內容","","error")}}}),T=S,O=(0,x.A)(T,R,U,!1,null,"93638e7c",null),q=O.exports,B={components:{CustomDataTable:c.A,CustomDialog:u.A,CreateGroupForm:y,ReadGroupForm:L,UpdateGroupForm:q},data(){return{dialog:!1,loading:!0,items:[],itemsLength:0,disabled_select:["title"],options:{page:1,itemsPerPage:30,sortBy:["id"],sortDesc:[!1]},headers:[{text:"id",value:"id",sortable:!0},{text:"操作",value:"actions",sortable:!0},{text:"角色名稱",value:"name_zh",sortable:!0},{text:"角色代號",value:"name",sortable:!0}],create_dialog:!1,read_dialog:!1,update_dialog:!1,read_id:null,update_id:null}},computed:{},async mounted(){await this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const t=(0,d.UH)(this.options),e=await n.Bd.get_all_group_with_profiles(t);if(200===e.status){const{data:t,count:a}=e.data;this.items=t,this.itemsLength=a}}catch(t){console.error(t)}finally{this.loading=!1}},emitUpdateOptions(t){this.options=t,this.fetchData()},async refreshData(){await this.fetchData(),this.create_dialog=!1,this.update_dialog=!1},emitCreate(){this.create_dialog=!0},emitRead(t){this.read_id=t,this.read_dialog=!0},emitUpdate(t){this.update_id=t,this.update_dialog=!0},async emitDelete(t){const e=await(0,d.d4)();if(e.isConfirmed){const e=await(0,d.JV)();if(e)try{const e=await n.GS.delete(t);204===e.status&&(this.$swal.fire("刪除成功","","success"),await this.fetchData())}catch(a){this.$swal.fire("刪除失敗",a,"error")}}}}},E=B,H=(0,x.A)(E,r,o,!1,null,"26237264",null),J=H.exports}}]);
//# sourceMappingURL=575.7587790a.js.map